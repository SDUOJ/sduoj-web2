{"version":3,"sources":["Pages/Client/CStudentMutualEvaluation.tsx"],"names":["CStudentMutualEvaluation","isLogin","useSelector","state","UserReducer","userInfo","useState","data","setData","evaluations","setEvaluations","isDisabled","setIsDisabled","优秀","良好","中等","差","gradeCounts","setGradeCounts","is_admin","set_is_admin","vote_status","set_vote_status","results","set_results","listUpd","CApi","getSMEList","then","res","undefined","error","message","status","my_evaluations","to_evaluate","newCounts","x","v","getRes","getSMEResult","admin","useEffect","columns","title","dataIndex","key","render","_","record","Group","onChange","e","studentId","value","prevValue","prevCounts","handleRadioChange","student_id","target","disabled","style","position","right","top","background","padding","boxShadow","level","textAlign","margin","nickname","username","display","justifyContent","maxWidth","dataSource","rowKey","pagination","type","onClick","console","log","submitSME","not_evaluated","info","toString","success","marginTop","ws","XLSX","json_to_sheet","Object","keys","map","wb","book_new","book_append_sheet","marginBottom","filters","text","onFilter","includes","sorter","a","b"],"mappings":"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","file":"static/js/55.58fcf3e6.chunk.js","sourcesContent":["import React, {useEffect, useState} from \"react\";\nimport Title from \"antd/es/typography/Title\";\nimport {useSelector} from \"react-redux\";\nimport CApi from \"../../Utils/API/c-api\";\nimport {Radio, Table, Button, message, Row, Col} from 'antd';\nimport * as XLSX from 'xlsx';\n\nconst CStudentMutualEvaluation = () => {\n    const isLogin = useSelector((state: any) => {\n        return state.UserReducer.isLogin\n    })\n    const userInfo = useSelector((state: any) => {\n        return state.UserReducer.userInfo\n    })\n    const [data, setData] = useState([]);\n    const [evaluations, setEvaluations] = useState<any>({});\n    const [isDisabled, setIsDisabled] = useState(false);\n    const [gradeCounts, setGradeCounts] = useState<{ [key: string]: number }>({\n        优秀: 0,\n        良好: 0,\n        中等: 0,\n        差: 0,\n    });\n    const [is_admin, set_is_admin] = useState<boolean>(false)\n    const [vote_status, set_vote_status] = useState<any>()\n    const [results, set_results] = useState<any>()\n\n    const listUpd = () => {\n        CApi.getSMEList({}).then((res: any) => {\n            if (res.error !== undefined) {\n                message.error(res.error)\n            } else if (res.status === \"已投票\") {\n                setEvaluations(res.my_evaluations)\n                setData(res.to_evaluate)\n                setIsDisabled(true);\n                setGradeCounts(() => {\n                    const newCounts: any = {...gradeCounts};\n                    for (let x in res.my_evaluations) {\n                        let v = res.my_evaluations[x]\n                        newCounts[v] = (newCounts[v] || 0) + 1;\n                    }\n                    return {...newCounts};\n                });\n            } else {\n                setData(res.to_evaluate)\n            }\n        })\n    }\n\n    const getRes = () => {\n        CApi.getSMEResult({}).then((res: any) => {\n            set_is_admin(res.admin)\n            if (res.admin) {\n                set_vote_status(res.vote_status)\n                set_results(res.results)\n            }\n        })\n    }\n\n    useEffect(() => {\n        if (isLogin) {\n            listUpd()\n            getRes()\n        }\n    }, [isLogin])\n\n    const exportToExcel = () => {\n        const ws = XLSX.utils.json_to_sheet([\n            ...Object.keys(vote_status).map((studentId) => ({\n                studentId,\n                status: vote_status[studentId],\n                ...results[studentId],\n            })),\n        ]);\n\n        const wb = XLSX.utils.book_new();\n        XLSX.utils.book_append_sheet(wb, ws, 'Sheet1');\n        XLSX.writeFile(wb, 'results.xlsx');\n    };\n\n    const handleRadioChange = (studentId: string, value: string) => {\n        const prevValue = evaluations[studentId];\n        setEvaluations({...evaluations, [studentId]: value});\n        setGradeCounts(prevCounts => {\n            const newCounts = {...prevCounts};\n            if (prevValue) {\n                newCounts[prevValue] = (newCounts[prevValue] || 1) - 1;\n            }\n            newCounts[value] = (newCounts[value] || 0) + 1;\n            return newCounts;\n        });\n    };\n    const handleSubmit = () => {\n        console.log('提交的评价:', evaluations);\n        CApi.submitSME({evaluations: evaluations}).then((res: any) => {\n            if (res.error !== undefined) {\n                message.error(res.error)\n                if (res.not_evaluated !== undefined) {\n                    message.info(res.not_evaluated.toString() + \" 未投票\")\n                }\n            } else {\n                message.success(\"投票成功\")\n                listUpd()\n                getRes()\n            }\n        })\n    };\n\n    const columns = [\n        {\n            title: \"学号\",\n            dataIndex: \"student_id\",\n            key: \"student_id\",\n        },\n        {\n            title: \"姓名\",\n            dataIndex: \"name\",\n            key: \"name\",\n        },\n        {\n            title: \"评价\",\n            key: \"evaluation\",\n            render: (_: any, record: any) => (\n                <Radio.Group\n                    onChange={(e) => handleRadioChange(record.student_id, e.target.value)}\n                    value={evaluations[record.student_id]}\n                    disabled={isDisabled}  // 根据状态变量来决定是否禁用 Radio\n                >\n                    <Radio value=\"优秀\">优秀</Radio>\n                    <Radio value=\"良好\">良好</Radio>\n                    <Radio value=\"中等\">中等</Radio>\n                    <Radio value=\"差\">差</Radio>\n                </Radio.Group>\n            ),\n        },\n    ];\n\n    return (\n        <>\n            {isLogin && (\n                <div\n                    style={{\n                        position: \"fixed\",\n                        right: \"20px\",\n                        top: \"30%\",\n                        background: \"#f9f9f9\",\n                        padding: \"20px\",\n                        boxShadow: \"0px 0px 5px rgba(0, 0, 0, 0.1)\",\n                    }}\n                >\n                    <Title level={5}>评价统计</Title>\n                    <p>优秀: {gradeCounts[\"优秀\"]}</p>\n                    <p>良好: {gradeCounts[\"良好\"]}</p>\n                    <p>中等: {gradeCounts[\"中等\"]}</p>\n                    <p>差: {gradeCounts[\"差\"]}</p>\n                </div>\n            )}\n            <div style={{textAlign: \"center\", margin: \"0 auto\"}}>\n                <Title> 22级学硕互评 </Title>\n                {!isLogin && (\n                    <Title level={5}> 您未登录，请在右上角使用【SDU统一身份认证】登录 </Title>\n                )}\n                {isDisabled && (\n                    <Title level={5}> 您已投票，您可以查看您的投票，但是不能再次编辑 </Title>\n                )}\n                {isLogin && (\n                    <>\n                        <Title level={5}> 姓名：{userInfo?.nickname}，学号：{userInfo?.username} </Title>\n                        <div style={{display: 'flex', justifyContent: 'center'}}>\n                            <div style={{maxWidth: 1200}}>\n                                <Table columns={columns} dataSource={data} rowKey=\"student_id\" pagination={false}/>\n                                <Button type=\"primary\" onClick={handleSubmit} style={{marginTop: 24}}\n                                        disabled={isDisabled}>\n                                    提交评价\n                                </Button>\n                            </div>\n                        </div>\n                        {is_admin && results && vote_status && (\n                            <>\n                                <div style={{display: 'flex', justifyContent: 'center', marginTop: 24}}>\n                                    <div style={{maxWidth: 1200}}>\n                                        <Title level={5}>投票状态和评价结果</Title>\n                                        <Button type=\"primary\" onClick={exportToExcel}\n                                                style={{marginTop: 24, marginBottom: 24}}>\n                                            导出为 Excel\n                                        </Button>\n                                        <Table\n                                            dataSource={Object.keys(vote_status).map((studentId) => ({\n                                                studentId,\n                                                status: vote_status[studentId],\n                                                ...results[studentId]\n                                            }))}\n                                            pagination={false}\n                                            columns={[\n                                                {title: '学号', dataIndex: 'studentId', key: 'studentId'},\n                                                {\n                                                    title: '状态',\n                                                    dataIndex: 'status',\n                                                    key: 'status',\n                                                    filters: [\n                                                        {text: '已投票', value: '已投票'},\n                                                        {text: '未投票', value: '未投票'},\n                                                    ],\n                                                    onFilter: (value, record) => record.status.includes(value),\n                                                },\n                                                {\n                                                    title: '优秀',\n                                                    dataIndex: '优秀',\n                                                    key: '优秀',\n                                                    sorter: (a, b) => a.优秀 - b.优秀\n                                                },\n                                                {\n                                                    title: '良好',\n                                                    dataIndex: '良好',\n                                                    key: '良好',\n                                                    sorter: (a, b) => a.良好 - b.良好\n                                                },\n                                                {\n                                                    title: '中等',\n                                                    dataIndex: '中等',\n                                                    key: '中等',\n                                                    sorter: (a, b) => a.中等 - b.中等\n                                                },\n                                                {\n                                                    title: '差',\n                                                    dataIndex: '差',\n                                                    key: '差',\n                                                    sorter: (a, b) => a.差 - b.差\n                                                },\n                                            ]}\n                                            rowKey=\"studentId\"\n                                        />\n                                    </div>\n                                </div>\n                            </>\n                        )}\n                    </>\n                )}\n            </div>\n        </>\n    )\n}\n\nexport default CStudentMutualEvaluation\n"],"sourceRoot":""}